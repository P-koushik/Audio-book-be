# Repository Guidelines

## Project Structure

- `index.ts`: Express server entrypoint.
- `routes/`: API route definitions (mounted under `/api/v1`).
- `controllers/`: Request handlers organized by domain (e.g., `controllers/users/`, `controllers/files/`).
- `services/`: Business logic and external integrations (S3, Firebase, ConvertAPI, HTML cleanup, TOC).
- `models/`: Mongoose models (MongoDB collections).
- `middlewares/`: Express middleware (e.g., CORS).
- `workers/`: Batch/background scripts (see `workers/README.md`).
- `types/`: Shared TypeScript types and type roots (see `tsconfig.json`).
- Build output: `.dist/` (generated by `npm run build`).

## Build, Test, and Development Commands

- `npm ci`: Install dependencies (matches CI).
- `npm run dev`: Run the API with `nodemon` + `ts-node` for local development.
- `npm run build`: Compile TypeScript to `.dist/`.
- `npm start`: Run the compiled server (`npm run build` first).
- `npm run worker:extract-pdf-text -- --pdfId <mongo_id>`: Extract and chunk PDF text.
- `npm run worker:initiate-process -- --pdfId <mongo_id>`: Re-run the PDF → HTML → cleanup → Markdown pipeline.
- CI uses Node.js 20 and currently calls `npm run lint`, `npm run format`, and `npm run typecheck`; keep `package.json` and `.github/workflows/ci.yml` in sync.

## Coding Style & Naming Conventions

- TypeScript (strict) + CommonJS output; prefer explicit types over `any`.
- Keep formatting consistent with the existing codebase: 2-space indentation, double quotes, semicolons.
- Organize changes by layer: routes → controllers → services → models.
- Use path aliases where helpful (e.g., `@/services/...`).

## Testing Guidelines

- Automated tests are not currently configured (`npm test` exits with an error). If adding tests, prefer a `tests/` folder and `*.test.ts` naming, and update CI accordingly.

## Commit & Pull Request Guidelines

- Follow the existing commit style (Conventional Commits-like): `feat: ...`, `fix: ...`, `refactor: ...`.
- Keep branches aligned with CI triggers (e.g., `feat/**`, `fix/**`, `refactor/**`, `kp/**`).
- PRs should include: purpose/summary, how to verify locally, and any new/changed env vars (also update `.env.example`).

## Security & Configuration

- Do not commit secrets. `.env` and `serviceAccountKey.json` are gitignored—use environment variables and document required keys in `.env.example`.
